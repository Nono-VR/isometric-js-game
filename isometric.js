var layer0 = [
	[2,2,2,2,2,2,2,2,2,2,2,2,2],
	[2,2,2,2,2,2,2,2,2,2,2,2,2],
	[2,2,2,2,2,2,2,2,2,2,2,2,2],
	[2,2,2,2,2,2,2,2,2,2,2,2,2],
	[2,2,2,2,2,2,2,2,2,2,2,2,2],
	[2,2,2,2,2,2,2,2,2,2,2,2,2],
	[2,2,2,2,2,2,2,2,2,2,2,2,2],
	[2,2,2,2,2,2,2,2,2,2,2,2,2],
	[2,2,2,2,2,2,2,2,2,2,2,2,2],
	[2,2,2,2,2,2,2,2,2,2,2,2,2],
	[2,2,2,2,2,2,2,2,2,2,2,2,2],
	[2,2,2,2,2,2,2,2,2,2,2,2,2],
	[2,2,2,2,2,2,2,2,2,2,2,2,2],
	[2,2,2,2,2,2,2,2,2,2,2,2,3],
	[2,2,2,2,2,2,2,2,2,2,2,2,3],
	[1,2,2,2,2,2,2,2,2,2,2,3,3],
	[1,1,2,2,2,2,2,2,2,2,3,3,3],
	[1,1,2,2,3,1,2,2,2,2,3,3,3],
	[1,1,1,2,3,3,1,2,2,2,3,3,3],
	[1,1,1,3,3,3,1,2,2,3,3,3,2],
	[1,1,1,1,3,3,3,1,2,3,3,3,2],
	[1,1,1,1,3,3,3,1,3,3,3,2,2],
	[1,1,1,1,1,3,3,3,3,3,3,2,2],
	[1,1,1,1,1,3,3,3,3,3,2,2,2],
	[1,1,1,1,1,1,3,3,3,3,2,2,2],
	[1,1,1,1,1,1,3,3,3,2,2,2,2],
	[1,1,1,1,1,1,3,3,3,2,2,2,2],
	[1,1,1,1,1,3,3,3,3,2,2,2,2],
	[1,1,1,1,1,3,3,3,3,3,2,2,2],
	[1,1,1,1,3,3,3,3,3,3,2,2,2],
	[1,1,1,1,1,3,3,3,3,3,2,2,2],
	[1,1,1,1,1,3,3,3,3,2,2,2,1],
	[1,1,1,1,1,1,3,3,3,2,2,2,1],
	[1,1,1,1,1,3,3,3,3,1,2,1,1],
	[1,1,1,1,1,3,3,3,3,3,1,1,1],
	[1,1,1,1,1,3,3,3,3,3,1,1,1],
	[1,1,1,1,1,1,3,3,3,3,3,1,1],
	[1,1,1,1,1,1,1,3,3,3,3,1,1],
	[1,1,1,1,1,1,1,1,3,3,3,3,1],
	[1,1,1,1,1,1,1,1,3,3,3,3,1],
	[1,1,1,1,1,1,1,1,3,3,3,3,1],
	[1,1,1,1,1,1,1,1,3,3,3,3,1]
]

var layer1 = [
	[1,1,1,1,1,1,1,1,1,1,1,1,1],
	[1,1,1,1,1,1,1,1,1,1,1,1,1],
	[1,1,1,1,1,1,1,1,1,1,1,1,1],
	[1,1,1,1,1,1,1,1,1,1,1,1,1],
	[1,1,1,1,1,1,1,1,1,1,1,1,1],
	[1,1,1,1,1,1,1,1,1,1,1,1,1],
	[1,1,1,1,1,1,1,1,1,1,1,1,1],
	[1,1,1,1,1,1,1,1,1,1,1,1,1],
	[1,1,1,1,1,1,1,1,1,1,1,1,1],
	[1,1,1,1,1,1,1,1,1,1,1,1,1],
	[1,1,1,1,1,1,1,1,1,1,1,1,1],
	[1,1,1,1,1,1,1,1,1,1,1,1,1],
	[1,1,1,1,1,1,1,1,1,1,1,1,1],
	[1,1,1,1,1,1,1,1,1,1,1,1,0],
	[1,1,1,1,1,1,1,1,1,1,1,1,0],
	[1,1,1,1,1,1,1,1,1,1,1,0,0],
	[1,1,1,1,1,1,4,1,1,1,0,0,0],
	[1,1,1,1,0,0,4,1,1,1,0,0,0],
	[1,4,1,1,0,0,0,4,4,1,0,0,0],
	[0,4,1,0,0,0,0,4,4,0,0,0,1],
	[0,0,4,0,0,0,0,0,4,0,0,0,1],
	[0,0,0,0,0,0,0,0,0,0,0,1,1],
	[0,0,0,0,0,0,0,0,0,0,0,1,1],
	[0,0,0,0,0,0,0,0,0,0,1,1,1],
	[0,0,0,0,0,0,0,0,0,0,1,1,1],
	[0,0,0,0,0,0,0,0,0,1,1,1,1],
	[0,0,0,0,0,0,0,0,0,1,1,1,1],
	[0,0,0,0,0,0,0,0,0,1,1,1,1],
	[0,0,0,0,0,0,0,0,0,0,1,1,1],
	[0,0,0,0,0,0,0,0,0,0,1,1,1],
	[0,0,0,0,0,0,0,0,0,0,1,1,1],
	[0,0,0,0,0,0,0,0,0,1,1,1,0],
	[0,0,0,0,0,0,0,0,0,1,1,1,0],
	[0,0,0,0,0,0,0,0,0,0,1,4,0],
	[0,0,0,0,0,0,0,0,0,0,0,4,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0]
]

var layer2 = [
	[1,1,1,1,1,1,1,1,1,1,1,1,1],
	[1,1,1,1,1,1,1,1,1,1,1,1,1],
	[1,1,1,1,1,1,1,1,1,1,1,1,1],
	[1,1,1,1,1,1,1,1,1,1,1,1,1],
	[1,1,1,1,1,1,1,1,1,1,1,1,1],
	[1,1,1,1,1,1,1,1,1,1,1,1,1],
	[1,1,1,1,1,1,1,1,4,1,1,1,1],
	[1,1,1,1,1,1,1,4,4,1,1,1,1],
	[1,1,1,1,1,1,1,0,4,4,1,1,1],
	[1,1,1,0,1,1,0,0,4,4,1,1,4],
	[1,1,1,0,1,1,0,0,0,4,4,1,4],
	[0,1,4,0,1,0,0,0,0,4,4,4,0],
	[0,0,4,0,0,0,0,0,0,0,4,4,0],
	[0,0,0,0,0,0,0,0,0,0,4,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,1],
	[0,0,0,0,0,0,0,0,0,0,0,0,1],
	[0,0,0,0,0,0,0,0,0,0,0,1,1],
	[0,0,0,0,0,0,0,0,0,0,0,1,1],
	[0,0,0,0,0,0,0,0,0,0,0,1,1],
	[0,0,0,0,0,0,0,0,0,0,0,4,1],
	[0,0,0,0,0,0,0,0,0,0,0,4,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0]
]

var master = [];
master[0] = layer0;
master[1] = layer1;
master[2] = layer2;

var obj0 = [
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[15,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,16,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,15,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0]
]

var obj1 = [
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,7,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,6,5,0,0,0,0,0,0,0],
	[0,0,0,6,0,0,0,0,0,0,0,0,0],
	[0,0,0,6,0,0,0,0,0,0,0,0,0],
	[0,0,6,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,16,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,5,0,0,0],
	[0,0,0,0,0,0,0,0,0,5,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0]
]

var obj2 = [
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,15,0,0,0],
	[0,0,0,0,0,15,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,15,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,5,0,0,0,0,0,0,0,0],
	[0,0,0,0,5,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0]
]

var objMaster = [];
objMaster[0] = obj0;
objMaster[1] = obj1;
objMaster[2] = obj2;

//Object Arrays
var sprites = [];
var waters = [];
var zIndexSprites = [[],[],[]];
var objSprites = [];
var topSprites = [];
var collisionArray = [[],[],[]];

var waterState;

//Magic Numbers
var TILESIZE = 76;
var HALFTILE = 38;
var QUARTERTILE = 19;

//Map Size
var mapX = layer0.length;
var mapY = layer0[0].length;
var mapZ = master.length;


var player = null;
var playerX = 0;
var playerY = 0;
var playerLevel = 2;
var hit = false;
var winLose = false;
var mapPopulated = false;

var up = false;
var down = false;
var right = false;
var left = false;

var canvas1 = document.getElementById("viewport1");
var canv2d1 = canvas1.getContext("2d");
var canX = canvas1.width;
var canY = canvas1.height;

var canvas2 = document.getElementById("viewport1");
var canv2d2 = canvas2.getContext("2d");

var canvas3 = document.getElementById("viewport3");
var canv2d3 = canvas3.getContext("2d");

var image = new Image();
image.src = "sprites.png";

//Input
window.addEventListener("keydown", function(event)
{
	switch(event.keyCode)
	{
		case 38:
			up = true;
			break;
		
		case 40:
			down = true;
			break;
		
		case 39:
			right = true;
			break;
		
		case 37:
			left = true;
			break;
	}
}, false);

window.addEventListener("keyup", function(event)
{
	switch(event.keyCode)
	{
		case 38:
			up = false;
			break;
		
		case 40:
			down = false;
			break;
		
		case 39:
			right = false;
			break;
		
		case 37:
			left = false;
			break;
	}
}, false);

//Objects
var spriteObject =
{
	id: 0,
	sourceX: 0,
	sourceY: 0,
	sourceWidth: TILESIZE,
	sourceHeight: TILESIZE,
	x: 0,
	y: 0,
	vx: 0,
	vy: 0,
	width: TILESIZE,
	height: TILESIZE,
	visible: true,
	centerX: function()
	{
		return this.x + (this.width / 2);
	},
	centerY: function()
	{
		return this.y + (this.height / 2);
	},
	halfWidth: function()
	{
		return (this.width - 0) / 2;
	},
	halfHeight: function()
	{
		return (this.height - 0) / 2;
	}
};

//Hit and Block Functions
function hitCircle(c1, c2)
{
	var vx = c1.centerX() - c2.centerX();
	var vy = c1.centerY() - c2.centerY();
	var magnitude = Math.sqrt(vx * vx + vy * vy);
	var totalRecal = c1.halfWidth() + c2.halfWidth();
	var hit = magnitude < totalRecal;
	return hit;
}

function hitRectangle(r1, r2)
{
	var hit = false;
	var vx = r1.centerX() - r2.centerX();
	var vy = r1.centerY() - r2.centerY();
	var combinedHalfWidths = r1.halfWidth() + r2.halfWidth();
	var combinedHalfHeights = r1.halfHeight() + r2.halfHeight();
	if(Math.abs(vx) < combinedHalfWidths)
	{
		if(Math.abs(vy) < combinedHalfHeights)
		{
		hit = true;
		}
		else
		{
		hit = false;
		}   
	}
	else
	{
		hit = false;
	}
	return hit;
}

function blockRectangle(r1, r2)
{
	var collisionSide = "";
	var vx = r1.centerX() - r2.centerX();
	var vy = r1.centerY() - r2.centerY();
	var combinedHalfWidths = r1.halfWidth() + r2.halfWidth();
	var combinedHalfHeights = r1.halfHeight() + r2.halfHeight();
	if(Math.abs(vx) < combinedHalfWidths) 
	{
		if(Math.abs(vy) < combinedHalfHeights)
		{
			var overlapX = combinedHalfWidths - Math.abs(vx);
			var overlapY = combinedHalfHeights - Math.abs(vy);
			if(overlapX >=  overlapY)
			{
				if(vy > 0)
				{
					collisionSide = "top";
					r1.y = r1.y + overlapY;
				}
				else 
				{
					collisionSide = "bottom";
					r1.y = r1.y - overlapY;
				}
			} 
			else 
			{
				if(vx > 0)
				{
					collisionSide = "left";
					r1.x = r1.x + overlapX;
				}
				else 
				{
					collisionSide = "right";
					r1.x = r1.x - overlapX;
				}
			} 
		}
		else 
		{
			collisionSide = "none";
		}
	} 
	else 
	{
		collisionSide = "none";
	}
	return collisionSide;
}

//Start
(function()
{
	console.log("Start");
	reset();
	updatePlayerHight()
})();

function reset()
{
	popMap();
}

update();
function update()
{
	if(winLose == false)
	{
		playGame();
		updateZIndex();
	}
	requestAnimationFrame(update, canvas1);
	render();
}

setInterval(function(){ updateAnimation(); }, 1000);
function updateAnimation()
{
	for(var i = 0; i < waters.length; i++)
	{
		var water = waters[i];
		switch(waterState)
		{
			case 0:
				water.sourceX = TILESIZE * 2;
				break;
				
			case 1:
				water.sourceX = TILESIZE * 3;
				break;
				
			case 2:
				water.sourceX = TILESIZE * 4;
				break;
				
			case 3:
				water.sourceX = TILESIZE * 5;
				break;
		}
	}
	if(waterState < 3)
	{
		waterState++;
	}
	else
	{
		waterState = 0;
	}
}

function updateZIndex()
{	
	for(var i = 0; i < zIndexSprites.length; i++)
	{
		var obj = zIndexSprites[i]
		if(obj.y + obj.sourceHeight < player.y + player.sourceHeight)
		{
			obj.visible = false;
		}
		if(obj.y + obj.sourceHeight > player.y + player.sourceHeight)
		{
			obj.visible = true;
		}
	}
	
	for(var i = 0; i < objSprites.length; i++)
	{
		var obj = objSprites[i]
		if(obj.y + obj.sourceHeight < player.y + player.sourceHeight)
		{
			obj.visible = false;
		}
		if(obj.y + obj.sourceHeight > player.y + player.sourceHeight)
		{
			obj.visible = true;
		}
	}
}

function updatePlayerHight()
{
	//topSprites = objSprites.concat(zIndexSprites[playerLevel]);
}

function popMap()
{
	var zAjust = 0;
	var stagger;
	for(var z = 0; z < mapZ; z++)
	{
		for(var y = 0; y < mapX; y++)
		{	
			for(var x = 0; x < mapY; x++)
			{
				var currentTileNum = master[z][y][x];
				if(currentTileNum !== 0)
				{
					zAjust = z * HALFTILE;
					if(y%2 == 0)
					{
						stagger = HALFTILE;
					}
					else
					{
						stagger = 0;
					}
					switch(currentTileNum)
					{
						case 1:
							var grass = Object.create(spriteObject);
							grass.sourceX = 0;
							grass.sourceY = 0;
							grass.x = (x * TILESIZE - stagger);
							grass.y = (y * QUARTERTILE) - zAjust;
							sprites.push(grass);
							var grass2 = $.extend(true, {}, grass);
							collisionArray[z].push(grass);
							zIndexSprites[z].push(grass2);
							break;
							
						case 2:
							var dirt = Object.create(spriteObject);
							dirt.sourceX = TILESIZE;
							dirt.sourceY = 0;
							dirt.x = (x * TILESIZE - stagger);
							dirt.y = (y * QUARTERTILE) - zAjust;
							sprites.push(dirt);
							var dirt2 = $.extend(true, {}, dirt);
							collisionArray[z].push(dirt);
							zIndexSprites[z].push(dirt2);
							break;
							
						case 3:
							var water = Object.create(spriteObject);
							water.sourceX = TILESIZE * 2;
							water.sourceY = 0;
							water.x = (x * TILESIZE - stagger);
							water.y = (y * QUARTERTILE) - zAjust;
							sprites.push(water);
							waters.push(water);
							collisionArray[z].push(water);
							break;
							
						case 4:
							var grasshalf = Object.create(spriteObject);
							grasshalf.sourceX = 0;
							grasshalf.sourceY = TILESIZE;
							grasshalf.x = (x * TILESIZE - stagger);
							grasshalf.y = (y * QUARTERTILE) - zAjust;
							sprites.push(grasshalf);
							var grasshalf2 = $.extend(true, {}, grasshalf);
							collisionArray[z].push(grasshalf);
							zIndexSprites[z].push(grasshalf2);
							break;
					}
				}
			}
		}
	}
	var zAjust = 0;
	var stagger;
	for(var z = 0; z < mapZ; z++)
	{
		for(var y = 0; y < mapX; y++)
		{	
			for(var x = 0; x < mapY; x++)
			{
				var currentTileNum = objMaster[z][y][x];
				if(currentTileNum !== 0)
				{
					zAjust = z * HALFTILE;
					if(y%2 == 0)
					{
						stagger = HALFTILE;
					}
					else
					{
						stagger = 0;
					}
					switch(currentTileNum)
					{
						case 5:
							var fenceleft = Object.create(spriteObject);
							fenceleft.sourceX = 92;
							fenceleft.sourceY = TILESIZE;
							fenceleft.width = 42;
							fenceleft.height = 48;
							fenceleft.sourceWidth = 42;
							fenceleft.sourceHeight = 48;
							fenceleft.x = (x * TILESIZE - stagger) + 18;
							fenceleft.y = (y * QUARTERTILE) - zAjust - 18;
							sprites.push(fenceleft);
							var fenceleft2 = $.extend(true, {}, fenceleft);
							objSprites.push(fenceleft2);
							collisionArray[z].push(fenceleft);
							break;
						
						case 6:
							var fenceright = Object.create(spriteObject);
							fenceright.sourceX = 174;
							fenceright.sourceY = TILESIZE;
							fenceright.width = 42;
							fenceright.height = 48;
							fenceright.sourceWidth = 42;
							fenceright.sourceHeight = 48,
							fenceright.x = (x * TILESIZE - stagger) + 18;
							fenceright.y = (y * QUARTERTILE) - zAjust - 18;
							sprites.push(fenceright);
							var fenceright2 = $.extend(true, {}, fenceright);
							objSprites.push(fenceright2);
							collisionArray[z].push(fenceright);
							break;
							
						case 15:
							var greentree = Object.create(spriteObject);
							greentree.sourceX = 0;
							greentree.sourceY = 328;
							greentree.width = 102;
							greentree.height = 128;
							greentree.sourceWidth = 102,
							greentree.sourceHeight = 128,
							greentree.x = (x * TILESIZE - stagger + 22);
							greentree.y = (y * QUARTERTILE) - zAjust - 4;
							sprites.push(greentree);
							var greentree2 = $.extend(true, {}, greentree);
							objSprites.push(greentree2);
							collisionArray[z].push(greentree);
							break;
						
						case 16:
							var tree = Object.create(spriteObject);
							tree.sourceX = 102;
							tree.sourceY = 328;
							tree.width = 112;
							tree.height = 128;
							tree.sourceWidth = 112;
							tree.sourceHeight = 128;
							tree.x = (x * TILESIZE - stagger + 16);
							tree.y = (y * QUARTERTILE) - zAjust - 2;
							sprites.push(tree);
							var tree2 = $.extend(true, {}, tree);
							objSprites.push(tree2);
							collisionArray[z].push(tree);
							break;
					}
				}
			}
		}
	}
	
	player = Object.create(spriteObject);
	player.sourceX = 0;
	player.sourceY = TILESIZE * 2;
	player.x = (7 * TILESIZE);
	player.y = (7 * QUARTERTILE);
	sprites.push(player);
	
	console.log("mapPopulated");
	mapPopulated = true;
}

function playGame()
{
	//Player Movement
	if(up && !down)
	{
		player.vy = -.5;
	}
	if(down && !up)
	{	
		player.vy = .5;
	}
	if(left && !right)
	{
		player.vx = -1;
	}
	if(right && !left)
	{	
		player.vx = 1;
	}
	if(!up && !down)
	{
		player.vy = 0;
	}
	if(!left && !right)
	{
		player.vx = 0;
	}
	player.x += player.vx;
	player.y += player.vy;
	
	//Flip Character 
	if(player.vx < 0)
	{
		player.sourceX = 0;
	}
	if(player.vx > 0)
	{
		player.sourceX = TILESIZE;
	}
	
	var playerX = Math.floor(player.x / TILESIZE);
	var playerY = Math.floor(player.y / QUARTERTILE);
	for(var i = 0; i < collisionArray[playerLevel].length; i++)
	{
		var currentTile = collisionArray[playerLevel][i];
		var collisionX = Math.floor(currentTile.x / TILESIZE);
		var collisionY = Math.floor(currentTile.y / QUARTERTILE);
		if(collisionY == playerY && collisionX  == playerX)
		{
			//blockRectangle(player, currentTile)
		}
	}
	
	//Screen Bounding Box
	player.x = Math.max(0, Math.min(player.x + player.vx, canvas1.width-player.width - 0));
	player.y = Math.max(0, Math.min(player.y + player.vy, canvas1.height-player.height - 0));
}

//NOT FUNTIONAL
/*function gameOver()
{
	end = Object.create(spriteObject);
	end.sourceY = 132;
	end.sourceWidth = 128;
	end.sourceHeight = 64;
	end.width = 128;
	end.height = 64;
	end.x = canvas1.width / 2 - end.width /2;
	end.y = canvas1.height / 2 - end.height /2;
	sprites.push(end);
}

function gameWin()
{
	win = Object.create(spriteObject);
	win.sourceY = 64;
	win.sourceWidth = 128;
	win.sourceHeight = 64;
	win.width = 128;
	win.height = 64;
	win.x = canvas1.width / 2 - win.width /2;
	win.y = canvas1.height / 2 - win.height /2;
	sprites.push(win);
}*/

function render()
{
	if(sprites.length !== 0)
	{
		for(var i = 0; i < sprites.length; i++)
		{
			var sprite = sprites[i];
			if(sprite.visible)
			{
				canv2d1.drawImage(image, sprite.sourceX, sprite.sourceY, sprite.sourceWidth, sprite.sourceHeight, Math.floor(sprite.x), Math.floor(sprite.y), sprite.width, sprite.height);
			}
		}
	}
	
	if(zIndexSprites.length !== 0)
	{
		for(var i = 0; i < zIndexSprites.length; i++)
		{
			var sprite2 = zIndexSprites[i];
			if(sprite2.visible)
			{
				canv2d2.drawImage(image, sprite2.sourceX, sprite2.sourceY, sprite2.sourceWidth, sprite2.sourceHeight, Math.floor(sprite2.x), Math.floor(sprite2.y), sprite2.width, sprite2.height);
			}
		}
	}
	
	if(objSprites.length !== 0)
	{
		for(var i = 0; i < objSprites.length; i++)
		{
			var sprite3 = objSprites[i];
			if(sprite3.visible)
			{
				canv2d3.drawImage(image, sprite3.sourceX, sprite3.sourceY, sprite3.sourceWidth, sprite3.sourceHeight, Math.floor(sprite3.x), Math.floor(sprite3.y), sprite3.width, sprite3.height);
			}
		}
	}
}